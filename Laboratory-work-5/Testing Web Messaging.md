## Тестування Веб-повідомлень
| ID |
|:-:|
| WSTG-CLNT-11 |

### Короткий опис

Веб-повідомлення (також відомі як [Міжсторінкова комунікація](https://html.spec.whatwg.org/multipage/web-messaging.html#web-messaging)) дозволяють програмам, які працюють у різних доменах, безпечно спілкуватися. До введення веб-повідомлень комунікація між різними джерелами (між iframe(кадр в кадрі), вкладками та вікнами) була обмежена політикою одного джерела і контролювалася браузером. Розробники використовували різні хаки для виконання цих завдань, але більшість з них були не безпечними.

Це обмеження в браузері призначене для запобігання зловмисному веб-сайту зчитувати конфіденційні дані з інших iframe(кадр в кадрі), вкладок тощо; однак існують випадки, коли два довірені веб-сайти повинні обмінюватися даними один з одним. Для вирішення цього завдання було введено міжсторінкову комунікацію в проекті специфікації [WHATWG HTML5](https://html.spec.whatwg.org/multipage/) та реалізовано в усіх основних браузерах. Вона забезпечує безпечну комунікацію між різними джерелами через iframe(кадр в кадрі), вкладки та вікна. 

API повідомлення ввів [метод `розміщенняПовідомлення()`](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage), за допомогою якого можна відправляти текстові повідомлення між джерелами. Він складається з двох параметрів: повідомлення та домен.  

Існують певні питання з безпеки при використанні `*` як домену, які обговорюються нижче. Щоб отримувати повідомлення, веб-сайт-одержувач повинен додати новий обробник подій, який має такі атрибути:
- Дані - вміст вхідного повідомлення;
- Походження документа-відправника; та
- Джерело - джерело вікна.

Ось приклад використання API повідомлень. Для відправлення повідомлення:
```
iframe1.Вікно-вмісту.розміщенняПовідомлення("Привіт світ","http://www.example.com");
```
Для отримання повідомлення:
```
вікно.додатиОбробникПодій("повідомлення", обробник, істинний);
обробник функції(подія) {
    якщо(подія.походження === 'chat.example.com') {
        /* обробити повідомлення (подія.дані) */
    } інше {
        /* ігнорування повідомлень від ненадійних доменів */
    }
}
```

#### Безпека походження

Походження складається з схеми, імені хоста та порту. Воно однозначно ідентифікує домен, що відправляє або отримує повідомлення, і не включає частину URL або фрагмент. Наприклад, `https://example.com` буде вважатися відмінним від `http://example.com` через те, що схема першої - `https`, а другої - `http`. Те ж саме стосується веб-серверів, які працюють в одному домені, але на різних портах.

### Цілі Тестування
#### Перевірка Безпеки Вихідного Джерела

Тестувальники повинні перевірити, чи код додатка фільтрує та обробляє повідомлення від довірених доменів. Також в рамках домену-відправника варто переконатися, що домен-отримувач явно вказаний, і символ `*` не використовується як другий аргумент для методу `розміщенняПовідомлення()`. Ця практика може створювати загрози для безпеки і призвести до ситуацій, коли в разі перенаправлення або зміни походження іншими способами веб-сайт буде надсилати дані на невідомі сервери, і тим самим може викидати конфіденційні дані на зловмисні сервери.

Якщо веб-сайт не додає обмежень безпеки для доменів або походження, які мають право надсилати повідомлення на веб-сайт, існує велика ймовірність виникнення загрози для безпеки. Тестувальники повинні аналізувати код для слухачів подій повідомлень та вибирати функцію з методу `додатиОбробникПодій` для подальшого аналізу. Домени повинні завжди перевірятися перед обробкою даних.

